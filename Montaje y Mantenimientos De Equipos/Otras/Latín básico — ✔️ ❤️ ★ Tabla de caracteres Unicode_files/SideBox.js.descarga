"use strict";(function (Unicode,go){Unicode.Side.Box=go.Class([go.Ext.Nodes],{'nodes':{'title':{'selector':"h2 a",'events':{click:"onClickTitle"}},'rangeA':{selector:"#diap-a",'events':{click:"onClickRange"}},'separate':".separate-page",'begin':"#diap-begin",'end':"#diap-end",'count':"#symb-count",'type':"#block-type",'languages':"#block-languages",'countries':"#block-countries",'map':".worldmap",'desc':".desc",'dhelp':".help"},'NODE_MAP_DOT':".map-dot",__construct:function __construct(side,node){this.initNodes(node);this.side=side;this.cache={};this.cacheCurrent();},__destruct:function __destruct(){this.doneNodes();},selectBlock:function selectBlock(data){if (this.current===data.key){return;}this.current=data.key;this.nodes.begin.text(Unicode.Helper.alignWidth(data.begin));this.nodes.end.text(Unicode.Helper.alignWidth(data.end));this.nodes.count.text(parseInt(data.end,16) - parseInt(data.begin,16) + 1);this.nodes.title.find("span").text(data.name);this.nodes.title.attr("href",data.url);this.nodes.separate.attr("href",data.url);this.requestParams();this.setTitle(data);},onClickTitle:function onClickTitle(e){e.preventDefault();e.originalEvent._sideClick=true;this.side.toggleList();},onClickRange:function onClickRange(){if (this.nodes.dhelp.length > 0){this.nodes.dhelp.hide();document.cookie="dhelp=off;max-age:30000000;path=/";}this.side.onClickRange(this.current);},cacheCurrent:function cacheCurrent(){this.current=this.nodes.title.data("key");this.cache[this.current]={'key':this.current,'desc':this.nodes.desc.html(),'type':this.nodes.type.html(),'languages':this.nodes.languages.html(),'countries':this.nodes.countries.html(),'points':this.loadPoints()};},loadPoints:function loadPoints(){var nodes=this.nodes.map.find(this.NODE_MAP_DOT),node,len=nodes.length,points=[],i;this.points=[];for (i=0;i < len;i +=1){node=nodes.eq(i);points.push([parseInt(node.css("left"),10),parseInt(node.css("top"),10)]);this.points.push(node);}return points;},requestParams:function requestParams(){var data;if (this.cache[this.current]){this.drawBlock(this.cache[this.current]);}else{this.nodes.desc.html("...");this.nodes.type.html("...");this.nodes.languages.html("...");data={'key':this.current};Unicode.Ajax.request("block",data,this.onLoadedParams);}},onLoadedParams:function onLoadedParams(result){var countries,c,i,len;if (result.countries){len=result.countries.length;countries=[];result.points=[];for (i=0;i < len;i +=1){c=result.countries[i];countries.push(c[0]);if (c[1]){result.points.push(c);}}result.countries=countries.join(",");}this.cache[result.key]=result;if (result.key===this.current){this.drawBlock(result);}},drawBlock:function drawBlock(data){this.nodes.desc.html(data.desc);this.nodes.type.html(data.type);this.nodes.languages.html(data.languages);this.nodes.countries.html(data.countries);if (data.type){this.nodes.type.parent().show();}else{this.nodes.type.parent().hide();}if (data.languages){this.nodes.languages.parent().show();}else{this.nodes.languages.parent().hide();}if (data.countries){this.nodes.countries.parent().show();}else{this.nodes.countries.parent().hide();}this.drawPoints(data.points);},drawPoints:function drawPoints(points){var i,len,point,node;if (this.points){for (i=0,len=this.points.length;i < len;i +=1){this.points[i].remove();}this.points=null;}if (!points){return;}this.points=[];for (i=0,len=points.length;i < len;i +=1){point=points[i];node=$('<div class="map-dot" style="top:'+ point[2] + 'px;left:' +
point[1] + 'px;"><img src="/i/map-dot.png" alt="" title="' + point[0] + '" /></div>');this.nodes.map.append(node);this.points.push(node);}},setTitle:function setTitle(data){if (!this.oldTitle){this.oldTitle=document.title;if (data.key==="control-character"){return;}}if (data.name){document.title=data.name + " â€” " + this.oldTitle;}}});})(Unicode,go);