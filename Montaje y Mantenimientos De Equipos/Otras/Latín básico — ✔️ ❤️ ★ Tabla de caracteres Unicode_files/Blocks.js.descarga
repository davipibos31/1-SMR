"use strict";(function wrap(Unicode,go,$,window){Unicode.Blocks=go.Class({__construct:function __construct(node,list,offsetTop){this.node=node;this.list=list;this.blocks=[];this.offsetTop=offsetTop;this.highlighted=null;this.debug=new Unicode.BlocksDebug(this);this.loadStatic();this.setCurrent(this.blocks[0]);this.currentLine=0;},__destruct:function __destruct(){},moveToSymbol:function moveToSymbol(code,scroll){var num=Math.floor(code / Unicode.Config.BLOCK_SYMBOLS),block,node;if (num > 0){this.createBlock(num - 1);}block=this.createBlock(num);node=block.getSymbolNode(code);if (num + 1 < Unicode.Config.BLOCKS_COUNT){this.createBlock(num + 1);}this.setCurrent(block);scroll.scroll(node.offset().top - this.offsetTop);return node;},highlightBlock:function highlightBlock(begin,end){var beginB=Math.floor(begin / Unicode.Config.BLOCK_SYMBOLS),endB=Math.floor(end / Unicode.Config.BLOCK_SYMBOLS),block,currentB,currentE,i;for (i=beginB;i <=endB;i +=1){block=this.blocks[i];if (block){if (i===beginB){currentB=begin;}else{currentB=null;}if (i===endB){currentE=end;}else{currentE=null;}block.highlight(currentB,currentE);}}this.highlighted=[begin,end];},highlightBlockOff:function highlightBlockOff(){var begin,end,beginB,endB,block,currentB,currentE,i;if (!this.highlighted){return;}begin=this.highlighted[0];end=this.highlighted[1];beginB=Math.floor(begin / Unicode.Config.BLOCK_SYMBOLS);endB=Math.floor(end / Unicode.Config.BLOCK_SYMBOLS);for (i=beginB;i <=endB;i +=1){block=this.blocks[i];if (block){if (i===beginB){currentB=begin;}else{currentB=null;}if (i===endB){currentE=end;}else{currentE=null;}block.highlightOff(currentB,currentE);}}this.highlighted=null;},loadStatic:function loadStatic(){var nodes=$(".unicode_table"),len=nodes.length,i;for (i=0;i < len;i +=1){this.setBlock(new Unicode.BlockStatic(nodes.eq(i)));}},setCurrent:function setCurrent(block){this.current=block;block.calcBorders();this.debug.setCurrent(block.num);},setBlock:function setBlock(block){var blocks=this.blocks,num=block.num;if (blocks.length < num - 1){blocks.length=num;}blocks[num]=block;block.addEventListener("selectSymbol",this.onSelectSymbol);},createBlock:function createBlock(num){var blocks=this.blocks,block;if (blocks[num]){return blocks[num];}block=new Unicode.BlockDynamic(num);this.setBlock(block);this.debug.createBlock(block.num);this.list.onCreateBlock(block);return block;},onSelectSymbol:function onSelectSymbol(e){this.list.onSelectSymbol(e);},onWindowScroll:function onWindowScroll(e){e=e.data;if (e.down){this.onWindowScrollDown(e.top);}else{this.onWindowScrollUp(e.top);}if (this.current){this.currentLine=this.current.getLineByTop(e.top + this.offsetTop);}},onWindowScrollDown:function onWindowScrollDown(top){var BLOCKS_COUNT=Unicode.Config.BLOCKS_COUNT,HEIGHT_OFFSET=100;while ((top > this.current.bottom) && (BLOCKS_COUNT > this.current.num + 1)){this.setCurrent(this.createBlock(this.current.num + 1));}if (top + $(window).height() + HEIGHT_OFFSET > this.current.bottom){if (BLOCKS_COUNT > this.current.num + 1){this.createBlock(this.current.num + 1);}}},onWindowScrollUp:function onWindowScrollUp(top){var block,nnum;while ((top < this.current.top) && (this.current.num > 0)){nnum=this.current.num - 1;block=this.blocks[nnum];if (!block){block=this.createBlock(nnum);top +=block.node.width();this.list.scroll.scroll(top);}this.setCurrent(block);}},getLastBlock:function getLastBlock(){var len=this.blocks.length;return len ? this.blocks[len - 1]:null;},getPrevBlock:function getPrevBlock(block){var blocks=this.blocks,i;for (i=block.num - 1;i >=0;i -=1){if (blocks[i]){return blocks[i];}}return null;}});})(Unicode,go,jQuery,window);