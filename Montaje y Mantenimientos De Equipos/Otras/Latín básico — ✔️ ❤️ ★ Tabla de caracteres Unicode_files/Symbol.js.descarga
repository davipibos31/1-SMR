"use strict";(function (Unicode,go,$,window,ut){var popupOverlay=document.querySelector('.js-char-popup-overlay');Unicode.Symbol=go.Class([go.Ext.Nodes],{'nodes':{'vchar':".vchar",'desc':".desc a",'descEn':".desc-en",'unum':".unicode-num .code",'hnum':".html-code .code",'copy':".symbol-copy",'close':".char__close",},'BLOCK_SIZE':Unicode.Config.LINE_SIZE,CSS_SELECT:"sel",__construct:function __construct(node){var elInputCopy;this.initNodes(node);this.node.appendTo($("body"));this.visible=false;$(window).click(this.onWindowClick);this.node.click(this.onClick);this.cacheDescs={};this.nodeInputCopy=$("#input-for-clipboard");elInputCopy=this.nodeInputCopy[0];this.clipboard=new Clipboard(this.nodes.copy[0],{target:function (trigger){elInputCopy.style.display="inline";setTimeout(function (){elInputCopy.style.display="none";},0);return elInputCopy;}});this.clipboard.on("success",this.onSuccessCopy);var _self=this;this.nodes.close.on("click",function (){_self.hide()})},__destruct:function __destruct(){this.doneNodes();},select:function select(code,nodeCurrent){this.current=code;if (this.nodeCurrent){this.nodeCurrent.removeClass(this.CSS_SELECT);}this.nodeCurrent=nodeCurrent;this.show();},show:function show(){popupOverlay.style.display='block';var dec=parseInt(this.current,10),hex=Unicode.Helper.dec2hex(dec),title,dtitle;if (!this.visible){if (this.isSmartphone()){this.node.css({'display':'flex'});}else{this.node.css({'display':'block'});}this.visible=true;}this.checkDec(dec);if (this.copier){this.nodes.copy.show();this.nodes.copy.data('symbol',$(this.nodeCurrent).data('symbol'));this.nodeInputCopy[0].value=(function (dec){var d=document.createElement("div");d.innerHTML='<input type="hidden" value="&#' + dec + ';" />';return d.getElementsByTagName("input")[0].value;})(dec);}else{this.nodes.copy.hide();}if (this.cvisible){title="&#" + this.dectitle + ";";}else{title="";}this.nodes.vchar.html(title);this.nodes.desc.text("loading ...");this.nodes.desc.attr("href","./" + hex + "/");this.nodes.unum.text("U+" + hex);this.nodes.hnum.text("&#" + this.current + ";");this.pos();this.nodeCurrent.addClass(this.CSS_SELECT);this.requestDesc();this.setFont(dec);},hide:function hide(){popupOverlay.style.display='none';if (this.visible){this.node.hide();this.nodeCurrent.removeClass(this.CSS_SELECT);this.nodeCurrent=null;this.visible=false;}},pos:function pos(){var offset=this.nodeCurrent.offset(),sheight=this.nodeCurrent.height(),top=offset.top + sheight + 5,nheight=this.node.height(),nwidth=this.node.outerWidth(),wtop=$(window).scrollTop(),wheight=$(window).height(),wwidth=window.innerWidth,left;if (offset.left + this.nodeCurrent.width() + nwidth + 5 < wwidth){left=offset.left + this.nodeCurrent.width() + 5;}else{if ( ((offset.left + this.nodeCurrent.width() + nwidth + 5) > wwidth) && (offset.left < nwidth) ){left=offset.left + wwidth - (offset.left + this.nodeCurrent.width() + nwidth + 5)}else{left=offset.left - nwidth - 5}}if (top + nheight - wtop > wheight){top=offset.top - nheight - 5;}this.node.css("top",top + "px");this.node.css("left",left + "px");},onWindowClick:function onWindowClick(e){if (!e.originalEvent._clickSymbol){this.hide();}},onWindowScroll:function onWindowScroll(){if (!this.isSmartphone()) this.hide();},isSmartphone:function(){return window.matchMedia("(max-width:1023px)").matches;},onClick:function onClick(e){e.originalEvent._clickSymbol=true;},requestDesc:function requestDesc(){var nblock=Math.floor(this.current / this.BLOCK_SIZE),block=this.cacheDescs[nblock],data,desc;if (block){if (block===true){return;}desc=block[this.current];this.nodes.desc.html(ut.common.wrapLastWordWithNoSpace(desc[0],'<span class="fa">&nbsp;&#61923;</span>'));if (desc[1]){this.nodes.descEn.show();this.nodes.descEn.text(desc[1]);}else{this.nodes.descEn.hide();}return;}this.cacheDescs[nblock]=true;data={'block':nblock,'size':this.BLOCK_SIZE,'c':this.current};Unicode.Ajax.request("desc",data,this.onSuccessLoad);},onSuccessLoad:function onSuccessLoad(result){this.cacheDescs[result.block]=result.descs;if (this.visible){this.requestDesc();}},onSuccessCopy:function (e){goal("copy_main");this.nodeInputCopy.hide();},setFont:function setFont(dec){var block=Unicode.Helper.dec2font(dec);this.nodes.vchar.attr("class","vchar u" + block);},checkDec:function checkDec(dec){this.cvisible=false;this.copier=false;if (dec < 32){this.cvisible=true;this.dectitle=dec + 57344;}else if (dec===127){this.cvisible=true;this.dectitle=9249;}else if ((dec >=128) && (dec < 160)){this.cvisible=true;this.dectitle=dec + 57344;}else if ((dec >=55296) && (dec <=57343)){this.cvisible=false;}else if (dec===1564){this.cvisible=false;}else{this.dectitle=dec;this.cvisible=true;this.copier=true;}},'eoc':null});})(Unicode,go,jQuery,window,ut);